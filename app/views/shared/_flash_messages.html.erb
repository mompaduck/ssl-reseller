<% if flash.any? %>
  <div id="flash-messages" class="fixed top-4 left-0 right-0 z-[9999] px-4">
    <% flash.each do |type, message| %>
      <% 
        bg_class = case type.to_s
                   when 'notice' then 'bg-green-500'
                   when 'alert', 'error' then 'bg-red-500'
                   else 'bg-blue-500'
                   end
      %>
      <div class="<%= bg_class %> text-white px-6 py-4 rounded-lg shadow-xl max-w-md mx-auto mb-2 flex items-center justify-between animate-slide-down">
        <span class="font-medium text-sm"><%= message %></span>
        <button onclick="this.parentElement.remove()" class="ml-4 text-white/80 hover:text-white transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    <% end %>
  </div>

  <script>
    // Use turbo:load event to ensure this runs after Turbo navigation
    document.addEventListener('turbo:load', function() {
      const flashContainer = document.getElementById('flash-messages');
      if (flashContainer && !flashContainer.dataset.dismissScheduled) {
        // Mark as scheduled to prevent duplicate timers
        flashContainer.dataset.dismissScheduled = 'true';
        
        // Auto dismiss after 5 seconds
        setTimeout(() => {
          if (flashContainer && flashContainer.parentElement) {
            flashContainer.style.opacity = '0';
            flashContainer.style.transition = 'opacity 0.5s';
            setTimeout(() => {
              if (flashContainer && flashContainer.parentElement) {
                flashContainer.remove();
              }
            }, 500);
          }
        }, 5000);
      }
    });
  </script>

  <style>
    @keyframes slide-down {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    .animate-slide-down {
      animation: slide-down 0.3s ease-out;
    }
  </style>
<% end %>
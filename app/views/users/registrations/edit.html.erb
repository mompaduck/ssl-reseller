<!-- app/views/users/registrations/edit.html.erb -->

<%# Main Content %>
<main class="min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center py-20 px-4">
  <div class="w-full max-w-md">
   
    <%# Login Card %>
    <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
      
      <%# Card Header %>
      <div class="bg-blue-600 px-8 py-6">
        <div class="flex items-center justify-center mb-2">
          <i data-lucide="user-cog" class="w-8 h-8 text-white"></i>
        </div>
        <h2 class="text-2xl font-bold text-white text-center">
          회원정보 수정
        </h2>
        <p class="text-blue-100 text-center mt-2 text-sm">
          계정 정보를 업데이트하세요
        </p>
      </div>




      <%# Form Content %>
      <div class="px-8 py-8">

        <%# Validation Errors %>
        <% if resource.errors.any? %>
          <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg" id="error_explanation">
            <h3 class="text-lg font-bold text-red-900 mb-2"><%= resource.errors.count %>개의 오류가 발생하여 저장이 불가능합니다:</h3>
            <ul class="list-disc list-inside text-sm text-red-800 space-y-1">
              <% resource.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%# Flash Messages %>
        <% if notice %>
          <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <p class="text-sm text-blue-800"><%= notice %></p>
          </div>
        <% end %>
      
        <% if alert %>
          <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded">
            <div class="flex items-center">
              <i data-lucide="alert-circle" class="w-5 h-5 text-red-500 mr-2"></i>
              <p class="text-sm text-red-800 font-semibold"><%= alert %></p>
            </div>
          </div>
        <% end %>

        <%= form_for(resource, as: resource_name, url: registration_path(resource_name),
              html: {
                data: {
                  controller: "phone-validate password-form"
                },
                class: "space-y-6"
              }) do |f| %>

        <%# 이메일 (변경 불가) %>
          <div>
            <%= f.label :email, "이메일 (변경 불가)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.email_field :email, disabled: true,
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm bg-gray-50 text-gray-500 cursor-not-allowed py-3 px-4" %>
            <p class="text-xs text-gray-500 mt-2">이메일은 보안상 변경할 수 없습니다</p>
          </div>
     

          <%# 이름 %>
          <div>
            <%= f.label :name, "이름", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.text_field :name, placeholder: "홍길동",
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
          </div>

          <%# 회사명 %>
          <div>
            <%= f.label :company_name, "회사명", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.text_field :company_name, placeholder: "회사명 입력",
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
          </div>

        <%# 전화번호 %>
        
      <div>
        <%= f.label :phone, "전화번호", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.telephone_field :phone,
              placeholder: "010-1234-5678",
              inputmode: "numeric",
              data: {
                "phone-validate-target": "input",
                action: "input->phone-validate#format blur->phone-validate#validate"
              },
              class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
        <p data-phone-validate-target="message" class="text-xs mt-2 hidden"></p>
          </div>

          <%# 영문 이름 %>
          <div>
            <%= f.label :english_name, "영문 이름", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.text_field :english_name, placeholder: "Hong Gildong",
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
            <p class="text-xs text-gray-500 mt-2">* OV/EV 인증서 주문 시 필수입니다</p>
          </div>

          <%# 국가 %>
          <div>
            <%= f.label :country, "국가", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.text_field :country, placeholder: "대한민국",
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
          </div>

          <%# 주소 %>
          <div>
            <%= f.label :address, "주소", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.text_field :address, placeholder: "서울시 강남구...",
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
          </div>

          <%# 알림 설정 %>
          <div class="border-t border-gray-200 pt-6">
            <h3 class="text-sm font-medium text-gray-900 mb-4 flex items-center gap-2">
              <i data-lucide="bell" class="w-4 h-4"></i>
              알림 설정
            </h3>
            
            <%= f.fields_for :notification_settings, OpenStruct.new(resource.notification_settings || {}) do |ns| %>
              <div class="space-y-3">
                <div class="flex items-start">
                  <div class="flex items-center h-5">
                    <%= ns.check_box :email_order_created, class: "focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded" %>
                  </div>
                  <div class="ml-3">
                    <%= ns.label :email_order_created, "주문 생성 시 이메일 알림", class: "text-sm font-medium text-gray-700" %>
                    <p class="text-xs text-gray-500">새로운 주문이 생성되면 이메일로 알림을 받습니다.</p>
                  </div>
                </div>
                
                <div class="flex items-start">
                  <div class="flex items-center h-5">
                    <%= ns.check_box :email_certificate_issued, class: "focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded" %>
                  </div>
                  <div class="ml-3">
                    <%= ns.label :email_certificate_issued, "인증서 발급 완료 시 이메일 알림", class: "text-sm font-medium text-gray-700" %>
                    <p class="text-xs text-gray-500">인증서가 성공적으로 발급되면 이메일로 알림을 받습니다.</p>
                  </div>
                </div>
                
                <div class="flex items-start">
                  <div class="flex items-center h-5">
                    <%= ns.check_box :email_certificate_expiring, class: "focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded" %>
                  </div>
                  <div class="ml-3">
                    <%= ns.label :email_certificate_expiring, "인증서 만료 예정 시 이메일 알림", class: "text-sm font-medium text-gray-700" %>
                    <p class="text-xs text-gray-500">인증서 만료 30일 전, 7일 전에 이메일로 알림을 받습니다.</p>
                  </div>
                </div>
              </div>
            <% end %>
          </div>

         

          <%# 구분선 %>
          <div class="border-t border-gray-200 pt-6">
            <h3 class="text-sm font-medium text-gray-900 mb-4">비밀번호 변경 (선택)</h3>
            
            <%# 새 비밀번호 %>
            <div class="mb-6">
              <%= f.label :password, "새 비밀번호", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.password_field :password, autocomplete: "new-password", placeholder: "새 비밀번호 입력 (변경 시에만)",
                    data: {
                      "password-form-target": "password",
                      action: "input->password-form#toggleCurrentPassword"
                    },
                    class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
              <p class="text-xs text-gray-500 mt-2">비밀번호를 변경하지 않으려면 비워두세요</p>
            </div>

            <%# 새 비밀번호 확인 %>
            <div>
              <%= f.label :password_confirmation, "새 비밀번호 확인", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.password_field :password_confirmation, autocomplete: "new-password", placeholder: "새 비밀번호 재입력",
                    class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
            </div>
          </div>

          <%# 현재 비밀번호 (필수) %>
          <div class="border-t border-gray-200 pt-6">
            <%= f.label :current_password, class: "block text-sm font-medium text-gray-700 mb-2", data: { "password-form-target": "currentPasswordLabel" } do %>
              현재 비밀번호 <span class="text-red-500 hidden">*</span>
            <% end %>
            <%= f.password_field :current_password, autocomplete: "current-password", placeholder: "현재 비밀번호 입력",
                  data: { "password-form-target": "currentPassword" },
                  class: "block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-gray-400 text-gray-900 bg-white py-3 px-4" %>
            <p class="text-xs text-gray-500 mt-2">정보 수정을 위해 현재 비밀번호를 입력해주세요</p>
          </div>

          <%# 수정 버튼 %>
          <div class="pt-2">
            <%= f.submit "정보 수정",
                  class: "w-full py-3 bg-blue-600 text-white text-base font-semibold rounded-lg hover:bg-blue-700 transition shadow-md cursor-pointer" %>
          </div>

        <% end %>

        <%# 계정 삭제 링크 %>
        <div class="mt-6 text-center pt-4 border-t border-gray-200">
          <p class="text-sm text-gray-600">
            계정 삭제를 원하시면
            <%= link_to "여기를 클릭하세요", 
                  delete_user_registration_path, 
                  class: "font-medium text-red-600 hover:text-red-500" %>
          </p>
        </div>


        <%# 뒤로가기 %>
        <div class="mt-4 text-center">
          <%= link_to :back, class: "inline-flex items-center gap-x-1 text-sm text-gray-600 hover:text-gray-900" do %>
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            돌아가기
          <% end %>
        </div>

      </div>
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
  });
  
  document.addEventListener('turbo:load', () => {
    lucide.createIcons();
  });
</script>
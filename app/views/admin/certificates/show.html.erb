<%# ============================================ %>
<%#  CERTIFICATE DETAIL PAGE - MAIN LAYOUT     %>
<%#  Uses Turbo Frames for tab navigation      %>
<%# ============================================ %>

<div class="container mx-auto px-4 py-6">

  <%# ============================================ %>
  <%#  HEADER - Domain Name + Status              %>
  <%# ============================================ %>

  <div class="mb-6">
    <%= link_to admin_certificates_path, class: "text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1 mb-3" do %>
      <i data-lucide="arrow-left" class="w-4 h-4"></i>
      <span>인증서 목록으로</span>
    <% end %>

    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
          <i data-lucide="shield-check" class="w-8 h-8 text-blue-600"></i>
          <%= @certificate.order.domain %>
        </h1>
        <p class="text-sm text-gray-500 mt-1">Certificate ID: #<%= @certificate.id %></p>
      </div>

      <% status_cfg = {
        "pending"    => { color:"bg-yellow-100 text-yellow-800 border-yellow-300", icon:"clock" },
        "issued"     => { color:"bg-green-100  text-green-800  border-green-300",  icon:"check-circle" },
        "dcv_failed" => { color:"bg-red-100    text-red-800    border-red-300",    icon:"x-circle" },
        "canceled"   => { color:"bg-gray-100   text-gray-800   border-gray-300",   icon:"ban" },
        "expired"    => { color:"bg-orange-100 text-orange-800 border-orange-300", icon:"alert-triangle" }
      }[@certificate.status] || { color:"bg-gray-100 text-gray-800 border-gray-300", icon:"help-circle" } %>

      <span class="px-4 py-2 rounded-lg text-sm font-bold border <%= status_cfg[:color] %>">
        <i data-lucide="<%= status_cfg[:icon] %>" class="w-4 h-4 inline mr-1"></i>
        <%= @certificate.status.to_s.upcase %>
      </span>
    </div>
  </div>

  <%# ============================================ %>
  <%#  TAB NAVIGATION                             %>
  <%# ============================================ %>

  <%= render 'tabs' %>

  <%# ============================================ %>
  <%#  TAB CONTENT CONTAINER (Turbo Frame)        %>
  <%# ============================================ %>

  <%= turbo_frame_tag "certificate_tab_content", src: overview_admin_certificate_path(@certificate) do %>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-center py-12">
        <div class="text-center">
          <i data-lucide="loader" class="w-8 h-8 text-gray-400 mx-auto mb-2 animate-spin"></i>
          <p class="text-sm text-gray-500">Loading...</p>
        </div>
      </div>
    </div>
  <% end %>

</div>

<script>
  // Reinitialize Lucide icons after Turbo Frame loads
  document.addEventListener('turbo:frame-load', function() {
    if (window.lucide) {
      window.lucide.createIcons();
    }
  });
</script>
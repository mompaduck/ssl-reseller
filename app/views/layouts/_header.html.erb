<%# app/views/layouts/_header.html.erb %>
<nav data-controller="menu"
     class="fixed top-0 left-0 w-full z-50 bg-blue-600 text-white shadow-md">
  <div class="container mx-auto px-4 max-w-7xl flex items-center justify-between h-16">

    <!-- 로고 -->
    <%= link_to root_path, class: "flex items-center space-x-2 h-16" do %>
      <i data-lucide="lock" class="w-6 h-6"></i>
      <span class="text-xl font-bold">CertGate</span>
    <% end %>

    <!-- 데스크톱 메뉴 (md 이상에서 표시) -->
    <div class="hidden md:flex space-x-8 items-center">
      <% nav_items = [
        { href: root_path, label: '홈' },
        { href: products_path, label: '인증서' },
         { href: "", label: '고객지원' },
        { href: faq_path, label: 'FAQ' }
      ] %>

      <% nav_items.each do |item| %>
        <% if item[:href].starts_with?('#') %>
          <a href="<%= item[:href] %>" class="hover:text-blue-100 transition font-medium"><%= item[:label] %></a>
        <% else %>
          <%= link_to item[:label], item[:href], class: "hover:text-blue-100 transition font-medium" %>
        <% end %>
      <% end %>

      <%# 로그인 상태에 따라 다르게 표시 %>
      <% if user_signed_in? %>
        <%= link_to "마이페이지", dashboard_path, class: "hover:text-blue-100 transition font-medium" %>
        <%= link_to "로그아웃", destroy_user_session_path, data: { turbo_method: :delete, turbo: "false" }, class: "px-4 py-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition font-medium" %>
      <% else %>
        <%= link_to "로그인", new_user_session_path, data: { turbo: "false" }, class: "hover:text-blue-100 transition font-medium" %>
        <%= link_to "회원가입", new_user_registration_path, data: { turbo: "false" }, class: "px-4 py-2 rounded-lg bg-white text-blue-600 hover:bg-blue-50 transition font-semibold" %>
      <% end %>
    </div>

    <!-- 모바일 햄버거 버튼 (md 미만에서 표시) -->
    <div class="md:hidden">
      <button
        data-action="click->menu#toggle"
        class="p-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 transition"
        aria-label="Toggle Menu">
        <i data-lucide="menu" data-menu-target="openIcon" class="w-6 h-6"></i>
        <i data-lucide="x" data-menu-target="closeIcon" class="w-6 h-6 hidden"></i>
      </button>
    </div>
  </div>

  <!-- 모바일 메뉴 (md 미만에서만 표시) -->
  <div
    data-menu-target="menu"
    class="md:hidden overflow-hidden transition-all duration-500 ease-in-out max-h-0 opacity-0 bg-blue-700">
    <div class="flex flex-col space-y-2 p-4 border-t border-blue-500">
      <% nav_items.each do |item| %>
        <% if item[:href].starts_with?('#') %>
          <a href="<%= item[:href] %>" class="py-2 px-3 rounded-md hover:bg-blue-600 transition"><%= item[:label] %></a>
        <% else %>
          <%= link_to item[:label], item[:href], class: "py-2 px-3 rounded-md hover:bg-blue-600 transition" %>
        <% end %>
      <% end %>

      <% if user_signed_in? %>
        <%= link_to "마이페이지", dashboard_path, class: "py-2 px-3 rounded-md hover:bg-blue-600 transition" %>
        <%= link_to "로그아웃", destroy_user_session_path, data: { turbo_method: :delete, turbo: "false" }, class: "py-2 px-3 rounded-md hover:bg-blue-600 transition" %>
      <% else %>
        <%= link_to "로그인", new_user_session_path, data: { turbo: "false" }, class: "py-2 px-3 rounded-md hover:bg-blue-600 transition" %>
        <%= link_to "회원가입", new_user_registration_path, data: { turbo: "false" }, class: "py-2 px-3 rounded-md bg-white text-blue-600 hover:bg-blue-50 transition font-semibold" %>
      <% end %>
    </div>
  </div>
</nav>

<script>
  // Lucide 아이콘 초기화 (헤더용)
  document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
  });
  
  document.addEventListener('turbo:load', () => {
    lucide.createIcons();
  });
</script>